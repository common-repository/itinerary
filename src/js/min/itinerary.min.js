function ItineraryStop(t,e,i){var r,n,a;this.setId=function(t){r=t},this.getId=function(){return r},this.setItineraryId=function(t){n=t},this.getItineraryId=function(){return n},this.setType=function(t){a=t},this.getType=function(){return"type"},this.init=function(){this.setId(t),this.setItineraryId(e),this.setType(i)},this.init()}function flash(t){console.log("-----------FLASH------------"),clog(t),console.log("-----------FLASH------------")}!function(t,e){var i=function(){return i.get.apply(i,arguments)},r=i.utils={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},isPlainObject:function(t){return!!t&&"[object Object]"===Object.prototype.toString.call(t)},toArray:function(t){return Array.prototype.slice.call(t)},getKeys:Object.keys||function(t){var e=[],i="";for(i in t)t.hasOwnProperty(i)&&e.push(i);return e},encode:function(t){return String(t).replace(/[,;"\\=\s%]/g,function(t){return encodeURIComponent(t)})},decode:function(t){return decodeURIComponent(t)},retrieve:function(t,e){return null==t?e:t}};i.defaults={},i.expiresMultiplier=86400,i.set=function(i,n,a){if(r.isPlainObject(i))for(var o in i)i.hasOwnProperty(o)&&this.set(o,i[o],n);else{a=r.isPlainObject(a)?a:{expires:a};var s=a.expires!==e?a.expires:this.defaults.expires||"",c=typeof s;"string"===c&&""!==s?s=new Date(s):"number"===c&&(s=new Date(+new Date+1e3*this.expiresMultiplier*s)),""!==s&&"toGMTString"in s&&(s=";expires="+s.toGMTString());var u=a.path||this.defaults.path;u=u?";path="+u:"";var d=a.domain||this.defaults.domain;d=d?";domain="+d:"";var l=a.secure||this.defaults.secure?";secure":"";a.secure===!1&&(l=""),t.cookie=r.encode(i)+"="+r.encode(n)+s+u+d+l}return this},i.setDefault=function(t,n,a){if(r.isPlainObject(t)){for(var o in t)this.get(o)===e&&this.set(o,t[o],n);return i}if(this.get(t)===e)return this.set.apply(this,arguments)},i.remove=function(t){t=r.isArray(t)?t:r.toArray(arguments);for(var e=0,i=t.length;e<i;e++)this.set(t[e],"",-1);return this},i.removeSpecific=function(t,e){if(!e)return this.remove(t);t=r.isArray(t)?t:[t],e.expires=-1;for(var i=0,n=t.length;i<n;i++)this.set(t[i],"",e);return this},i.empty=function(){return this.remove(r.getKeys(this.all()))},i.get=function(t,e){var i=this.all();if(r.isArray(t)){for(var n={},a=0,o=t.length;a<o;a++){var s=t[a];n[s]=r.retrieve(i[s],e)}return n}return r.retrieve(i[t],e)},i.all=function(){if(""===t.cookie)return{};for(var e=t.cookie.split("; "),i={},n=0,a=e.length;n<a;n++){var o=e[n].split("="),s=r.decode(o.shift()),c=r.decode(o.join("="));i[s]=c}return i},i.enabled=function(){if(navigator.cookieEnabled)return!0;var t="_"===i.set("_","_").get("_");return i.remove("_"),t},"function"==typeof define&&define.amd?define(function(){return{cookie:i}}):"undefined"!=typeof exports?exports.cookie=i:window.cookie=i}("undefined"==typeof document?null:document);var Itinerary;!function(t){function e(e,i,r){t.ajax({type:"get",url:ajax.url,data:{action:"add_itinerary_stop",id:e.getId(),itineraryId:e.getItineraryId(),type:e.getType()},success:function(t){t.status&&"function"==typeof i?i(t):"function"==typeof r&&r(t)}})}function i(e,i,r){t.ajax({type:"get",url:ajax.url,data:{action:"remove_itinerary_stop",id:e.getId(),type:e.getType()},success:function(t){t.status&&"function"==typeof i?i(t):"function"==typeof r&&r(t)}})}function r(e){var i=t('.itinerary-garage-stop [data-id="'+e+'"]').parent().parent();i.slideUp(500)}function n(e,i){var r=t('[data-id="'+e+'"]'),n="js-add-to-itinerary add",a="js-remove-from-itinerary remove";switch("undefined"==typeof i&&(i="add"),i){case"remove":r.removeClass(n).addClass(a);break;default:r.removeClass(a).addClass(n)}}function a(t,e){"undefined"==typeof e&&(e=!0),e?t.addClass("working"):t.removeClass("working")}function o(e){t(".itinerary-stop-count").addClass("added"),setTimeout(function(){t(".itinerary-stop-count").text(e).removeClass("added")},500)}t("body").on("click",".js-add-to-itinerary",function(){var i=t(this),r=i.attr("data-type"),s=i.attr("data-id"),c=i.attr("data-itinerary-id"),u=new ItineraryStop(s,c,r);return!(""==u.getId()||!Number(u.getId()))&&(a(i),void e(u,function(e){n(e.stopId,"remove"),o(e.stopCount),t(".itinerary-garage-stops .sortable").append(e.html),a(i,!1)},function(t){flash(t)}))}),t("body").on("click",".js-remove-from-itinerary",function(){var e=t(this),s=e.attr("data-type"),c=e.attr("data-id"),u=new ItineraryStop(c,s);return!(""==u.getId()||!Number(u.getId()))&&(a(e),void i(u,function(t){n(t.stopId,"add"),r(t.stopId),o(t.stopCount),a(e,!1)}))}),t("body").on("click",".itinerary-garage-toggle",function(){t(this).toggleClass("active"),t(".itinerary-garage, body").toggleClass("itinerary-garage-viewing"),t(".itinerary-garage-contents").toggleClass("visible")}),Itinerary={cookieName:"user_itinerary",cookie:!1,init:function(){var t=this.getCookie();t||this.createItinerary(),console.log(t,this)},createItinerary:function(e){var i=this;console.log("create: ",ajax),t.ajax({type:"get",url:ajax.url,data:{action:"new_itinerary",queriedObjectId:ajax.object_id},success:function(e){console.log("created itinerary"),console.log(e.data),i.setCookie(e.data.itinerary.itineraryId,e.data.itinerary.userId),t(".js-itinerary-add-to-placeholder").length&&t(".js-itinerary-add-to-placeholder").replaceWith(e.data.html)},complete:function(t){console.log(t)}})},setCookie:function(t,e){var i={itineraryId:t,userId:e};this.cookie=i,console.log(this.cookie),cookie.set(this.cookieName,JSON.stringify(i))},getCookie:function(){return this.cookie=JSON.parse(cookie.get(this.cookieName,!1)),this.cookie},getStops:function(e){var i=this;t.ajax({type:"get",url:ajax.url,data:{action:"get_itinerary_stops"},success:function(e){console.log(e),t("body").append(e.html);for(var i in e.itinerary_stops)if(e.itinerary_stops.hasOwnProperty(i)){var r=e.itinerary_stops[i];n(r,"remove")}},complete:function(){"function"==typeof e&&e(i)}})},showGarage:function(){var e=this;t.ajax({type:"get",url:ajax.url,data:{action:"get_itinerary_garage"},success:function(i){t("body").append(i.html),e.allowSortable()}})},updateGarageStopOrder:function(e){t.ajax({type:"get",url:ajax.url,data:{action:"update_garage_stop_order",ids:e},success:function(t){App.flash(t)}})},allowSortable:function(){var e=this;t(".sortable").sortable({update:function(){var i=t(this).sortable("toArray",{attribute:"data-stop-id"});e.updateGarageStopOrder(i)}})}},Itinerary.init(),setTimeout(function(){t(".mh-garage-stop").matchHeight({byRow:!1}),t(".itinerary-garage.initializing").removeClass("initializing")},1e3)}(jQuery);